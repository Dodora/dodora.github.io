<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="智慧屋">
<meta property="og:url" content="http://dodora.github.io/index.html">
<meta property="og:site_name" content="智慧屋">
<meta property="article:author" content="dora">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://dodora.github.io/"/>





  <title>智慧屋</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">智慧屋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://dodora.github.io/2020/05/03/%E6%96%B0%E9%97%BB%E5%88%86%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dora">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="智慧屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/03/%E6%96%B0%E9%97%BB%E5%88%86%E7%B1%BB/" itemprop="url">新闻分类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-03T21:44:56-07:00">
                2020-05-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据分析之新闻分类"><a href="#数据分析之新闻分类" class="headerlink" title="数据分析之新闻分类"></a>数据分析之新闻分类</h1><h2 id="加载数据集"><a href="#加载数据集" class="headerlink" title="加载数据集"></a>加载数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">'font.family'</span>] = <span class="string">'SimHei'</span></span><br><span class="line">plt.rcParams[<span class="string">'axes.unicode_minus'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">news = pd.read_csv(<span class="string">'chinese_news.csv'</span>)</span><br><span class="line">print(news.shape) <span class="comment">#csv有多少行和多少列</span></span><br><span class="line">display(news.head())</span><br></pre></td></tr></table></figure>

<pre><code>(20738, 4)</code></pre><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>tag</th>
      <th>headline</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>2016-01-01</td>
      <td>详细全文</td>
      <td>陆军领导机构火箭军战略支援部队成立大会在京举行 习近平向中国人民解放军陆军火箭军战略支援部队...</td>
      <td>中国人民解放军陆军领导机构、中国人民解放军火箭军、中国人民解放军战略支援部队成立大会2015...</td>
    </tr>
    <tr>
      <td>1</td>
      <td>2016-01-01</td>
      <td>详细全文</td>
      <td>中央军委印发《关于深化国防和军队改革的意见》</td>
      <td>经中央军委主席习近平批准，中央军委近日印发了《关于深化国防和军队改革的意见》。\n《意见》强...</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2016-01-01</td>
      <td>详细全文</td>
      <td>《习近平关于严明党的纪律和规矩论述摘编》出版发行</td>
      <td>由中共中央纪律检查委员会、中共中央文献研究室编辑的《习近平关于严明党的纪律和规矩论述摘编》一...</td>
    </tr>
    <tr>
      <td>3</td>
      <td>2016-01-01</td>
      <td>详细全文</td>
      <td>以实际行动向党中央看齐 向高标准努力</td>
      <td>广大党员干部正在积极学习习近平总书记在中央政治局专题民主生活会上的重要讲话。大家纷纷表示要把...</td>
    </tr>
    <tr>
      <td>4</td>
      <td>2016-01-01</td>
      <td>详细全文</td>
      <td>【年终特稿】关键之年 改革挺进深水区</td>
      <td>刚刚过去的2015年，是全面深化改革的关键之年。改革集中发力在制约经济社会发展的深层次矛盾，...</td>
    </tr>
  </tbody>
</table>
</div>


<h2 id="缺失值处理"><a href="#缺失值处理" class="headerlink" title="缺失值处理"></a>缺失值处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">news.isnull().sum(axis = <span class="number">0</span>) <span class="comment">#每一列的缺失值个数 </span></span><br><span class="line"><span class="comment">#news.info()</span></span><br></pre></td></tr></table></figure>




<pre><code>date          0
tag           0
headline      0
content     107
dtype: int64</code></pre><p>可知，内容存在缺失值，我们使用标题来代替内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index = news[news[<span class="string">'content'</span>].isnull()].index <span class="comment">#index是属性，函数要加括号</span></span><br><span class="line">news[<span class="string">'content'</span>][index] = news[<span class="string">'headline'</span>][index]</span><br><span class="line">news.isnull().sum()</span><br><span class="line"><span class="comment">#news['content'].isnull() #取一列，变成series 没有行列</span></span><br></pre></td></tr></table></figure>




<pre><code>date        0
tag         0
headline    0
content     0
dtype: int64</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">news.loc[index].sample(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>tag</th>
      <th>headline</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>875</td>
      <td>2016-02-23</td>
      <td>详细全文</td>
      <td>杨晶主持会议。\n习近平对加强老龄工作作出重要指示强调 加强顶层设计完善重大政策制度 及时科...</td>
      <td>杨晶主持会议。\n习近平对加强老龄工作作出重要指示强调 加强顶层设计完善重大政策制度 及时科...</td>
    </tr>
    <tr>
      <td>11057</td>
      <td>2017-07-13</td>
      <td>国际</td>
      <td>美将向罗马尼亚出售“爱国者”</td>
      <td>美将向罗马尼亚出售“爱国者”</td>
    </tr>
    <tr>
      <td>1181</td>
      <td>2016-03-11</td>
      <td>详细全文</td>
      <td>全国政协十二届四次会议举行第三次全体会议</td>
      <td>全国政协十二届四次会议举行第三次全体会议</td>
    </tr>
    <tr>
      <td>590</td>
      <td>2016-02-04</td>
      <td>国内</td>
      <td>新一轮叙利亚问题和谈暂时中止</td>
      <td>新一轮叙利亚问题和谈暂时中止</td>
    </tr>
    <tr>
      <td>10919</td>
      <td>2017-07-06</td>
      <td>国内</td>
      <td>中星9A依靠自身推进器成功入轨</td>
      <td>中星9A依靠自身推进器成功入轨</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="重复值处理"><a href="#重复值处理" class="headerlink" title="重复值处理"></a>重复值处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(news.duplicated().sum()) <span class="comment">#news.duplicated 返回bool值</span></span><br><span class="line">display(news[news.duplicated()])</span><br></pre></td></tr></table></figure>

<pre><code>5</code></pre><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>tag</th>
      <th>headline</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>13280</td>
      <td>2017-10-24</td>
      <td>详细全文</td>
      <td>中国共产党第十九届中央委员会委员名单</td>
      <td>中国共产党第十九届中央委员会委员名单</td>
    </tr>
    <tr>
      <td>13284</td>
      <td>2017-10-24</td>
      <td>详细全文</td>
      <td>中国共产党第十九届中央委员会候补委员名单</td>
      <td>中国共产党第十九届中央委员会候补委员名单</td>
    </tr>
    <tr>
      <td>13288</td>
      <td>2017-10-24</td>
      <td>详细全文</td>
      <td>中国共产党第十九届中央纪律检查委员会委员名单</td>
      <td>中国共产党第十九届中央纪律检查委员会委员名单</td>
    </tr>
    <tr>
      <td>13305</td>
      <td>2017-10-25</td>
      <td>详细全文</td>
      <td>中国共产党第十九届中央委员会第一次全体会议公报</td>
      <td>中国共产党第十九届中央委员会第一次全体会议公报</td>
    </tr>
    <tr>
      <td>13325</td>
      <td>2017-10-25</td>
      <td>详细全文</td>
      <td>中国共产党第十九届中央纪律检查委员会第一次全体会议公报</td>
      <td>中国共产党第十九届中央纪律检查委员会第一次全体会议公报</td>
    </tr>
  </tbody>
</table>
</div>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">news.drop_duplicates(inplace = <span class="literal">True</span>) <span class="comment">#inplace = True用在df和series</span></span><br><span class="line">print(news.duplicated().sum())</span><br></pre></td></tr></table></figure>

<pre><code>0</code></pre><h2 id="文本内容清洗"><a href="#文本内容清洗" class="headerlink" title="文本内容清洗"></a>文本内容清洗</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">re_obj = re.compile(<span class="string">r'[＂＃＄％＆＇（）＊＋，－／：；＜＝＞＠［＼］＾＿｀｛｜｝～｟｠｢｣､、〃》「」『』【】〔〕〖〗〘〙〚〛〜〝〞〟〰〾〿–—‘’‛“”„‟…‧﹏\n]+'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clear</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> re_obj.sub(<span class="string">''</span>,text)</span><br><span class="line"></span><br><span class="line">news[<span class="string">'content'</span>] = news[<span class="string">'content'</span>].apply(clear)</span><br><span class="line">news.sample(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>tag</th>
      <th>headline</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>12178</td>
      <td>2017-09-04</td>
      <td>详细全文</td>
      <td>张德江会见布隆迪参议长</td>
      <td>全国人大常委会委员长张德江4日在人民大会堂会见布隆迪参议长恩迪库里约。张德江说中布友谊源远流...</td>
    </tr>
    <tr>
      <td>6184</td>
      <td>2016-11-27</td>
      <td>国际</td>
      <td>以色列感谢巴方援助扑灭山火</td>
      <td>肆虐以色列的山火26号进入第五天多处起火点火情得到控制但在约旦河西岸的犹太人定居点哈拉米什耶...</td>
    </tr>
    <tr>
      <td>20450</td>
      <td>2018-09-24</td>
      <td>国际</td>
      <td>月是故乡明 人是家乡亲</td>
      <td>今夜月明人尽望又是万家欢乐时。爱如满月中秋最圆。让我们随着直播镜头走进月光品味幸福。</td>
    </tr>
    <tr>
      <td>10519</td>
      <td>2017-06-15</td>
      <td>国际</td>
      <td>索马里首都遭袭 19人死亡</td>
      <td>索马里首都摩加迪沙霍丹地区一家酒店餐厅14日晚发生汽车炸弹袭击及人质劫持事件已造成至少19人...</td>
    </tr>
    <tr>
      <td>14456</td>
      <td>2017-12-15</td>
      <td>国内</td>
      <td>2017中国海洋经济博览会举行</td>
      <td>2017中国海洋经济博览会在广东湛江举行。本届博览会以蓝色引领创新发展为主题吸引了来自全球6...</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line">s = <span class="string">'今天，外面下了一场很大的雨'</span></span><br><span class="line">words = jieba.cut(s) <span class="comment">#生成器</span></span><br><span class="line">print(list(words))</span><br><span class="line">words = jieba.lcut(s)</span><br><span class="line">print(words)</span><br></pre></td></tr></table></figure>

<pre><code>Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/mv/vdp034dn2vzg1lfs0wj8kf7r0000gp/T/jieba.cache
Loading model cost 0.677 seconds.
Prefix dict has been built successfully.


[&apos;今天&apos;, &apos;，&apos;, &apos;外面&apos;, &apos;下&apos;, &apos;了&apos;, &apos;一场&apos;, &apos;很大&apos;, &apos;的&apos;, &apos;雨&apos;]
[&apos;今天&apos;, &apos;，&apos;, &apos;外面&apos;, &apos;下&apos;, &apos;了&apos;, &apos;一场&apos;, &apos;很大&apos;, &apos;的&apos;, &apos;雨&apos;]</code></pre><h2 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cut_word</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> jieba.cut(text)</span><br><span class="line"></span><br><span class="line">news[<span class="string">'content'</span>] = news[<span class="string">'content'</span>].apply(cut_word)</span><br><span class="line">news.sample(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>tag</th>
      <th>headline</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>744</td>
      <td>2016-02-15</td>
      <td>国际</td>
      <td>日本去年第四季度GDP下滑</td>
      <td>&lt;generator object Tokenizer.cut at 0x128fe9250&gt;</td>
    </tr>
    <tr>
      <td>18234</td>
      <td>2018-06-14</td>
      <td>详细全文</td>
      <td>5月主要经济指标稳中向好</td>
      <td>&lt;generator object Tokenizer.cut at 0x129211ad0&gt;</td>
    </tr>
    <tr>
      <td>13531</td>
      <td>2017-11-05</td>
      <td>详细全文</td>
      <td>人民日报评论员文章：毫不动摇把党建设得更加坚强有力——九论学习贯彻党的十九大精神</td>
      <td>&lt;generator object Tokenizer.cut at 0x129179f50&gt;</td>
    </tr>
    <tr>
      <td>16251</td>
      <td>2018-03-14</td>
      <td>详细全文</td>
      <td>全国政协十三届一次会议主席团常务主席会议第二次会议举行</td>
      <td>&lt;generator object Tokenizer.cut at 0x1291d1b50&gt;</td>
    </tr>
    <tr>
      <td>17466</td>
      <td>2018-05-10</td>
      <td>国际</td>
      <td>波兰高速翻车 巧克力浆泄漏难清理</td>
      <td>&lt;generator object Tokenizer.cut at 0x1291f8e50&gt;</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="停用词处理"><a href="#停用词处理" class="headerlink" title="停用词处理"></a>停用词处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_stopword</span><span class="params">()</span>:</span></span><br><span class="line">    s = set()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"stopwords_utf8.txt"</span>, encoding = <span class="string">"UTF-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            s.add(line.strip())</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_stopword</span><span class="params">(words)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [word <span class="keyword">for</span> word <span class="keyword">in</span> words <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopword] <span class="comment">#返回一个列表，以逗号分隔</span></span><br><span class="line"><span class="comment">#stopword是个set不是list</span></span><br><span class="line"><span class="comment">#1.圆括号 生成器表达式   2.函数定义 不再是return 而是yield</span></span><br><span class="line"></span><br><span class="line">stopword = get_stopword()</span><br><span class="line">news[<span class="string">'content'</span>] = news[<span class="string">'content'</span>].apply(remove_stopword) <span class="comment">#传入生成器 返回列表</span></span><br><span class="line">news.sample(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>tag</th>
      <th>headline</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1001</td>
      <td>2016-02-29</td>
      <td>详细全文</td>
      <td>新华社客户端新版上线</td>
      <td>[新华社, 客户端, 新版, 今天, 上线, 发布, 新版, 客户端, 集, 互联网, 数据...</td>
    </tr>
    <tr>
      <td>14561</td>
      <td>2017-12-20</td>
      <td>详细全文</td>
      <td>中央经济工作会议在北京举行</td>
      <td>[中央, 经济, 工作, 会议, 12, 月, 18, 日至, 20, 日, 北京, 举行,...</td>
    </tr>
    <tr>
      <td>7636</td>
      <td>2017-02-08</td>
      <td>国内</td>
      <td>最高法：严惩暴力侵害法官及家属行为</td>
      <td>[最高人民法院, 昨天, 印发, 人民法院, 落实, 保护, 司法人员, 依法, 履行, 法...</td>
    </tr>
    <tr>
      <td>16461</td>
      <td>2018-03-24</td>
      <td>详细全文</td>
      <td>中国有能力有信心应对任何挑战</td>
      <td>[美国, 301, 调查, 多位, 权威专家, 纷纷表示, 中国, 能力, 信心, 应对, ...</td>
    </tr>
    <tr>
      <td>4752</td>
      <td>2016-09-12</td>
      <td>详细全文</td>
      <td>张德江会见越南总理</td>
      <td>[全国人大常委会, 委员长, 张德江, 12, 日, 人民大会堂, 会见, 越南, 总理, ...</td>
    </tr>
  </tbody>
</table>
</div>

















<h1 id="数据探索"><a href="#数据探索" class="headerlink" title="数据探索"></a>数据探索</h1><h2 id="类别数量分布"><a href="#类别数量分布" class="headerlink" title="类别数量分布"></a>类别数量分布</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t = news[<span class="string">'tag'</span>].value_counts()</span><br><span class="line">print(t)</span><br><span class="line">t.plot(kind = <span class="string">'bar'</span>) <span class="comment">#series的plot是基于matplotlib的</span></span><br></pre></td></tr></table></figure>

<pre><code>详细全文    11529
国内       6186
国际       3018
Name: tag, dtype: int64





&lt;matplotlib.axes._subplots.AxesSubplot at 0x121222610&gt;</code></pre><p><img src="output_28_2.png" alt="png"></p>
<h2 id="年份数量分布"><a href="#年份数量分布" class="headerlink" title="年份数量分布"></a>年份数量分布</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t = news[<span class="string">'date'</span>].str.split(<span class="string">'-'</span>,expand = <span class="literal">True</span>)</span><br><span class="line">t2 = t[<span class="number">0</span>].value_counts()</span><br><span class="line">print(t2)</span><br><span class="line">t2.plot(kind = <span class="string">'bar'</span>)</span><br><span class="line"><span class="comment">#t[1].value_counts().plot(kind = 'bar')</span></span><br><span class="line"><span class="comment">#t[2].value_counts().plot(kind = 'bar')</span></span><br></pre></td></tr></table></figure>

<pre><code>2017    7903
2016    6896
2018    5934
Name: 0, dtype: int64





&lt;matplotlib.axes._subplots.AxesSubplot at 0x135619a50&gt;</code></pre><p><img src="output_30_2.png" alt="png"></p>
<h2 id="词汇统计"><a href="#词汇统计" class="headerlink" title="词汇统计"></a>词汇统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">li_2d = news[<span class="string">'content'</span>].tolist() <span class="comment">#二维列表</span></span><br><span class="line">li_1d = list(chain.from_iterable(li_2d))</span><br><span class="line">print(<span class="string">f'总词汇量:<span class="subst">&#123;len(li_1d)&#125;</span>'</span>)</span><br><span class="line">c = Counter(li_1d)</span><br><span class="line">print(<span class="string">f'不重复词汇数量:<span class="subst">&#123;len(c)&#125;</span>'</span>)</span><br><span class="line">common = c.most_common(<span class="number">15</span>) <span class="comment">#返回从大到小的15个</span></span><br><span class="line">print(common)</span><br><span class="line">chain.from_iterable(li_2d)</span><br></pre></td></tr></table></figure>

<pre><code>总词汇量:2467431
不重复词汇数量:95742
[(&apos;发展&apos;, 20414), (&apos;中国&apos;, 18789), (&apos;习近平&apos;, 13424), (&apos;合作&apos;, 12320), (&apos;新&apos;, 11680), (&apos;年&apos;, 11666), (&apos;国家&apos;, 10878), (&apos;日&apos;, 10590), (&apos;中&apos;, 10562), (&apos;工作&apos;, 9328), (&apos;建设&apos;, 8332), (&apos;月&apos;, 8181), (&apos;表示&apos;, 7350), (&apos;经济&apos;, 7240), (&apos;主席&apos;, 6786)]





&lt;itertools.chain at 0x124084410&gt;</code></pre><h2 id="词频统计"><a href="#词频统计" class="headerlink" title="词频统计"></a>词频统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vocabulary, frequency = [],[]</span><br><span class="line"><span class="keyword">for</span> v,f <span class="keyword">in</span> common:</span><br><span class="line">    vocabulary.append(v)</span><br><span class="line">    frequency.append(f)</span><br><span class="line">plt.figure(figsize = (<span class="number">12</span>,<span class="number">5</span>)) <span class="comment">#长12cm宽5cm</span></span><br><span class="line">plt.bar(vocabulary, frequency)</span><br></pre></td></tr></table></figure>




<pre><code>&lt;BarContainer object of 15 artists&gt;</code></pre><p><img src="output_36_1.png" alt="png"></p>
<h2 id="百分比统计"><a href="#百分比统计" class="headerlink" title="百分比统计"></a>百分比统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">total = len(li_1d)</span><br><span class="line">percentage = [v * <span class="number">100</span> / total <span class="keyword">for</span> v <span class="keyword">in</span> frequency]</span><br><span class="line">print([<span class="string">f'<span class="subst">&#123;v:<span class="number">.2</span>f&#125;</span>'</span> <span class="keyword">for</span> v <span class="keyword">in</span> percentage])</span><br><span class="line">plt.figure(figsize = (<span class="number">12</span>,<span class="number">5</span>))</span><br><span class="line">plt.bar(vocabulary, percentage)</span><br></pre></td></tr></table></figure>

<pre><code>[&apos;0.83&apos;, &apos;0.76&apos;, &apos;0.54&apos;, &apos;0.50&apos;, &apos;0.47&apos;, &apos;0.47&apos;, &apos;0.44&apos;, &apos;0.43&apos;, &apos;0.43&apos;, &apos;0.38&apos;, &apos;0.34&apos;, &apos;0.33&apos;, &apos;0.30&apos;, &apos;0.29&apos;, &apos;0.28&apos;]





&lt;BarContainer object of 15 artists&gt;</code></pre><p><img src="output_38_2.png" alt="png"></p>
<h2 id="新闻词汇长度统计"><a href="#新闻词汇长度统计" class="headerlink" title="新闻词汇长度统计"></a>新闻词汇长度统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">num = [len(li) <span class="keyword">for</span> li <span class="keyword">in</span> li_2d]</span><br><span class="line">length = <span class="number">15</span></span><br><span class="line">plt.bar(range(length),sorted(num, reverse = <span class="literal">True</span>)[:length]) <span class="comment">#横轴和纵轴的个数要相等</span></span><br></pre></td></tr></table></figure>




<pre><code>&lt;BarContainer object of 15 artists&gt;</code></pre><p><img src="output_40_1.png" alt="png"></p>
<h2 id="新闻词汇长度分布统计"><a href="#新闻词汇长度分布统计" class="headerlink" title="新闻词汇长度分布统计"></a>新闻词汇长度分布统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.hist(num) <span class="comment">#分组频数统计图</span></span><br></pre></td></tr></table></figure>




<pre><code>(array([1.7622e+04, 2.6360e+03, 2.7700e+02, 1.0600e+02, 3.8000e+01,
        3.4000e+01, 1.4000e+01, 2.0000e+00, 3.0000e+00, 1.0000e+00]),
 array([   0. ,  209.8,  419.6,  629.4,  839.2, 1049. , 1258.8, 1468.6,
        1678.4, 1888.2, 2098. ]),
 &lt;a list of 10 Patch objects&gt;)</code></pre><p><img src="output_42_1.png" alt="png"></p>
<h2 id="生成词云图"><a href="#生成词云图" class="headerlink" title="生成词云图"></a>生成词云图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line"></span><br><span class="line"><span class="comment">#需要指定字体的位置，否则中文无法正常显示</span></span><br><span class="line">wc = WordCloud(font_path = <span class="string">r'/Users/duo/opt/anaconda3/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/ttf/SimHei.ttf'</span>,</span><br><span class="line">              width = <span class="number">800</span>, height = <span class="number">600</span>)</span><br><span class="line">li_2d = news[<span class="string">'content'</span>].tolist()</span><br><span class="line">li_1d = list(chain.from_iterable(li_2d))</span><br><span class="line">join_words = <span class="string">' '</span>.join(li_1d)</span><br><span class="line">img = wc.generate(join_words)</span><br><span class="line">plt.figure(figsize = (<span class="number">15</span>,<span class="number">10</span>))</span><br><span class="line">plt.imshow(img)</span><br><span class="line">plt.axis(<span class="string">'off'</span>) <span class="comment">#不要坐标轴</span></span><br><span class="line">wc.to_file(<span class="string">'wordcloud.png'</span>)</span><br></pre></td></tr></table></figure>




<pre><code>&lt;wordcloud.wordcloud.WordCloud at 0x1239c6950&gt;</code></pre><p><img src="output_47_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wc = WordCloud(font_path = <span class="string">r'/Users/duo/opt/anaconda3/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/ttf/SimHei.ttf'</span>,</span><br><span class="line">              mask = plt.imread(<span class="string">'/Users/duo/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/54e92ac7969f909714fb618cd36a83f4/Message/MessageTemp/666f0dbe506e84fd29701a2623dd533a/Image/16421588397019_.pic_hd.jpg'</span>))</span><br><span class="line">img = wc.generate(join_words)</span><br><span class="line">plt.figure(figsize = (<span class="number">15</span>,<span class="number">10</span>))</span><br><span class="line">plt.imshow(img)      </span><br><span class="line">plt.axis(<span class="string">'off'</span>)</span><br></pre></td></tr></table></figure>




<pre><code>(-0.5, 2108.5, 1625.5, -0.5)</code></pre><p><img src="output_48_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="comment">#词频是特征值，词语是特征</span></span><br><span class="line">count = CountVectorizer()</span><br><span class="line">docs = [</span><br><span class="line">    <span class="string">'Where there is a will, there is a way'</span>,</span><br><span class="line">    <span class="string">'There is no royal road to learning'</span>,</span><br><span class="line">]</span><br><span class="line">bag = count.fit_transform(docs) <span class="comment">#bag是一个稀疏的矩阵 稀疏矩阵只存储不为0的值</span></span><br><span class="line">print(bag)</span><br><span class="line">print(bag.shape)</span><br><span class="line">print(bag.toarray()) <span class="comment"># 调用稀疏矩阵的toarray方法，将稀疏矩阵转换为ndarray对象</span></span><br><span class="line">print(bag.toarray().shape)</span><br></pre></td></tr></table></figure>

<pre><code>  (0, 8)    1
  (0, 5)    2
  (0, 0)    2
  (0, 9)    1
  (0, 7)    1
  (1, 5)    1
  (1, 0)    1
  (1, 2)    1
  (1, 4)    1
  (1, 3)    1
  (1, 6)    1
  (1, 1)    1
(2, 10)
[[2 0 0 0 0 2 0 1 1 1]
 [1 1 1 1 1 1 1 0 0 0]]
(2, 10)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(count.get_feature_names()) <span class="comment">#获取所有的特征（单词名称）</span></span><br><span class="line">print(count.vocabulary_) <span class="comment">#输出单词与编号的映射关系</span></span><br></pre></td></tr></table></figure>

<pre><code>[&apos;is&apos;, &apos;learning&apos;, &apos;no&apos;, &apos;road&apos;, &apos;royal&apos;, &apos;there&apos;, &apos;to&apos;, &apos;way&apos;, &apos;where&apos;, &apos;will&apos;]
{&apos;where&apos;: 8, &apos;there&apos;: 5, &apos;is&apos;: 0, &apos;will&apos;: 9, &apos;way&apos;: 7, &apos;no&apos;: 2, &apos;royal&apos;: 4, &apos;road&apos;: 3, &apos;to&apos;: 6, &apos;learning&apos;: 1}</code></pre><p>向量化的特征仅为训练集中出现的单词特征，如果未知文档中的单词不在训练集中，则在词袋模型中无法体现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test_docs = [<span class="string">'While there is life there is hope.'</span>,<span class="string">'No pain, no gain.'</span>]</span><br><span class="line">t = count.transform(test_docs)</span><br><span class="line">print(t.toarray())</span><br></pre></td></tr></table></figure>

<pre><code>[[2 0 0 0 0 2 0 0 0 0]
 [0 0 2 0 0 0 0 0 0 0]]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer</span><br><span class="line"><span class="comment">#词频是特征值，词语是特征</span></span><br><span class="line">count = CountVectorizer()</span><br><span class="line">docs = [</span><br><span class="line">    <span class="string">'Where there is a will, there is a way'</span>,</span><br><span class="line">    <span class="string">'There is no royal road to learning'</span>,</span><br><span class="line">]</span><br><span class="line">bag = count.fit_transform(docs) <span class="comment">#bag是一个稀疏的矩阵 稀疏矩阵只存储不为0的值</span></span><br><span class="line">tfidf = TfidfTransformer()</span><br><span class="line">t = tfidf.fit_transform(bag) <span class="comment">#TfidfTransformer转换的结果也是稀疏矩阵</span></span><br><span class="line">print(t.toarray())</span><br></pre></td></tr></table></figure>

<pre><code>[[0.53594084 0.         0.         0.         0.         0.53594084
  0.         0.37662308 0.37662308 0.37662308]
 [0.29017021 0.4078241  0.4078241  0.4078241  0.4078241  0.29017021
  0.4078241  0.         0.         0.        ]]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line">docs = [</span><br><span class="line">    <span class="string">'Where there is a will, there is a way'</span>,</span><br><span class="line">    <span class="string">'There is no royal road to learning'</span>,</span><br><span class="line">]</span><br><span class="line">tfidf = TfidfVectorizer()</span><br><span class="line">t = tfidf.fit_transform(docs)</span><br><span class="line">print(t.toarray())</span><br></pre></td></tr></table></figure>

<pre><code>[[0.53594084 0.         0.         0.         0.         0.53594084
  0.         0.37662308 0.37662308 0.37662308]
 [0.29017021 0.4078241  0.4078241  0.4078241  0.4078241  0.29017021
  0.4078241  0.         0.         0.        ]]</code></pre><h1 id="建立模型"><a href="#建立模型" class="headerlink" title="建立模型"></a>建立模型</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">join</span><span class="params">(text_list)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">" "</span>.join(text_list) <span class="comment">#返回字符串</span></span><br><span class="line"></span><br><span class="line">news[<span class="string">'content'</span>] = news[<span class="string">'content'</span>].apply(join)</span><br><span class="line">news.sample(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>tag</th>
      <th>headline</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>8782</td>
      <td>2017-03-31</td>
      <td>国内</td>
      <td>去年上市公司现金分红共计8301亿元</td>
      <td>证监会 消息 2016 年 沪 深 两市 2031 家 公司 现金 分红 共计 8301 亿...</td>
    </tr>
    <tr>
      <td>18046</td>
      <td>2018-06-05</td>
      <td>国内</td>
      <td>“蓝盾—18”多军兵种联合防空演习举行</td>
      <td>空军 蓝盾 18 系列 演习 今天 华北 基地 举行 军兵种 地面 联合 防空 力量 运用 ...</td>
    </tr>
    <tr>
      <td>13776</td>
      <td>2017-11-16</td>
      <td>国际</td>
      <td>美国发动“媒体战” 俄罗斯出招回应</td>
      <td>回应 美国司法部 近日 今日 俄罗斯电视台 美国 频道 登记 外国 代理人 俄罗斯国家杜马 ...</td>
    </tr>
    <tr>
      <td>4924</td>
      <td>2016-09-21</td>
      <td>国内</td>
      <td>第十二届国际书法交流大展举行</td>
      <td>正在 天津 举行 第十二届 国际 书法 交流 大展 吸引 来自 日本 法国 19 国家 地区...</td>
    </tr>
    <tr>
      <td>4495</td>
      <td>2016-08-29</td>
      <td>详细全文</td>
      <td>中共中央办公厅印发《关于防止干部“带病提拔”的意见》</td>
      <td>中共中央办公厅 近日 印发 防止 干部 带病 提拔 意见 要求 各级党委 党组 防止 干部 ...</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">news[<span class="string">'tag'</span>] = news[<span class="string">'tag'</span>].map(&#123;<span class="string">'详细全文'</span>:<span class="number">0</span>, <span class="string">'国内'</span>:<span class="number">0</span>, <span class="string">'国际'</span>:<span class="number">1</span>&#125;)</span><br><span class="line">news[<span class="string">'tag'</span>].value_counts()</span><br></pre></td></tr></table></figure>




<pre><code>0    17715
1     3018
Name: tag, dtype: int64</code></pre><h2 id="构建训练集和测试集"><a href="#构建训练集和测试集" class="headerlink" title="构建训练集和测试集"></a>构建训练集和测试集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">X = news[<span class="string">'content'</span>]</span><br><span class="line">y = news[<span class="string">'tag'</span>]</span><br><span class="line"></span><br><span class="line">X_train,X_test,y_train,y_test = train_test_split(X,y,test_size = <span class="number">0.25</span>)</span><br><span class="line">print(<span class="string">'训练集样本数：'</span> , y_train.shape[<span class="number">0</span>],<span class="string">'测试集样本数：'</span>, y_test.shape[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<pre><code>训练集样本数： 15549 测试集样本数： 5184</code></pre><h2 id="实施向量化转换"><a href="#实施向量化转换" class="headerlink" title="实施向量化转换"></a>实施向量化转换</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vec = TfidfVectorizer(min_df = <span class="number">2</span>, ngram_range = (<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">X_train = vec.fit_transform(X_train)</span><br><span class="line">X_test = vec.transform(X_test)</span><br><span class="line">display(X_train,X_test)</span><br><span class="line">print(X_train.toarray())   <span class="comment">#行*列*8个字节</span></span><br></pre></td></tr></table></figure>


<pre><code>&lt;15549x216456 sparse matrix of type &apos;&lt;class &apos;numpy.float64&apos;&gt;&apos;
    with 2061174 stored elements in Compressed Sparse Row format&gt;



&lt;5184x216456 sparse matrix of type &apos;&lt;class &apos;numpy.float64&apos;&gt;&apos;
    with 614303 stored elements in Compressed Sparse Row format&gt;


[[0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 ...
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.max(np.max(X_train.toarray()))</span><br></pre></td></tr></table></figure>




<pre><code>1.0</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#把字节换算成GB</span></span><br><span class="line">X_train.shape[<span class="number">0</span>] * X_train.shape[<span class="number">1</span>] * <span class="number">8</span> / (<span class="number">1024</span> ** <span class="number">3</span>)</span><br><span class="line"><span class="comment">#1字节（byte） = 8bit bit是二进制位 ASCII编码方式 8位代表一个字母</span></span><br></pre></td></tr></table></figure>




<pre><code>25.076227962970734</code></pre><p><img src="%E7%A1%AC%E7%9B%98%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E5%8D%95%E4%BD%8D%E5%A4%A7%E5%B0%8F%E6%8D%A2%E7%AE%97.jpg" alt="cal"></p>
<img src="/2020/05/03/%E6%96%B0%E9%97%BB%E5%88%86%E7%B1%BB/%E7%A1%AC%E7%9B%98%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E5%8D%95%E4%BD%8D%E5%A4%A7%E5%B0%8F%E6%8D%A2%E7%AE%97.jpg" class="">

<h2 id="利用方差分析（ANOVA）进行特征选择"><a href="#利用方差分析（ANOVA）进行特征选择" class="headerlink" title="利用方差分析（ANOVA）进行特征选择"></a>利用方差分析（ANOVA）进行特征选择</h2><p><a href="https://www.cnblogs.com/massquantity/p/10486904.html" target="_blank" rel="noopener">https://www.cnblogs.com/massquantity/p/10486904.html</a></p>
<p>利用F检验找出前20000个对分类结果最有影响的特征（词）：类别：国内/国外新闻，样本数，总共21w个F值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectKBest</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> f_classif</span><br><span class="line"></span><br><span class="line">selector = SelectKBest(f_classif, k = min(<span class="number">20000</span>, X_train.shape[<span class="number">1</span>])) <span class="comment">#选择20000个和特征数量较少的那个 参数设置</span></span><br><span class="line"><span class="comment">#21w个单因素方差分析</span></span><br><span class="line">selector.fit(X_train, y_train) <span class="comment">#训练</span></span><br><span class="line">X_train = selector.transform(X_train).astype(np.float32) <span class="comment">#转换 用的时候还要再执行</span></span><br><span class="line">X_test = selector.transform(X_test).astype(np.float32)</span><br><span class="line">print(X_train.shape, X_test.shape)</span><br></pre></td></tr></table></figure>

<pre><code>(15549, 20000) (5184, 20000)</code></pre><h2 id="朴素贝叶斯算法实现分类与预测"><a href="#朴素贝叶斯算法实现分类与预测" class="headerlink" title="朴素贝叶斯算法实现分类与预测"></a>朴素贝叶斯算法实现分类与预测</h2><p><img src="bayes.png" alt="bayes"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> GaussianNB</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line"></span><br><span class="line">X_train = X_train.toarray()</span><br><span class="line">X_test = X_test.toarray()</span><br><span class="line"></span><br><span class="line">nb = GaussianNB()</span><br><span class="line">nb.fit(X_train, y_train) <span class="comment">#X是向量，y是值</span></span><br><span class="line">print(nb.score(X_train, y_train))<span class="comment">#模型训练好之后，把X_train放入，训练出一个y，跟y_train比较，得出准确度</span></span><br><span class="line">print(nb.score(X_test, y_test))<span class="comment">#训练集的准确度比测试集好，因为是用训练集来训练的，过拟合</span></span><br><span class="line">print(classification_report(y_test, nb.predict(X_test)))</span><br></pre></td></tr></table></figure>

<pre><code>0.9676506527750981
0.8964120370370371
              precision    recall  f1-score   support

           0       0.96      0.91      0.94      4459
           1       0.60      0.78      0.68       725

    accuracy                           0.90      5184
   macro avg       0.78      0.85      0.81      5184
weighted avg       0.91      0.90      0.90      5184</code></pre><h2 id="给定新闻，分类"><a href="#给定新闻，分类" class="headerlink" title="给定新闻，分类"></a>给定新闻，分类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新闻字符串转化成输入特征向量</span></span><br><span class="line">mynews = <span class="string">'中美元首会晤达成重要共识'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">news_pre</span><span class="params">(news)</span>:</span></span><br><span class="line">    news = clear(news)</span><br><span class="line">    words = cut_word(news)</span><br><span class="line">    words = remove_stopword(words)</span><br><span class="line">    words = <span class="string">' '</span>.join(words) <span class="comment">#把所有关键词拼接在一起，变成字符串</span></span><br><span class="line">    print(words)</span><br><span class="line">    words_matrix = vec.transform([words]) <span class="comment">#把words变成列表</span></span><br><span class="line">    print(words_matrix.toarray())</span><br><span class="line">    X_pre = selector.transform(words_matrix).astype(np.float32) <span class="comment">#特征变成2w</span></span><br><span class="line">    <span class="keyword">return</span> nb.predict(X_pre.toarray()) <span class="comment">#预测到0或1</span></span><br><span class="line">tag_dict = &#123;<span class="string">'国内'</span>:<span class="number">0</span>,<span class="string">"国际"</span>:<span class="number">1</span>&#125;</span><br><span class="line">output = news_pre(mynews)[<span class="number">0</span>]</span><br><span class="line">print(output)</span><br><span class="line">print(<span class="string">'这是一条'</span>+list(tag_dict.keys())[int(output)]+<span class="string">'新闻'</span>)</span><br></pre></td></tr></table></figure>

<pre><code>中 美元 首 会晤 达成 重要 共识
[[0. 0. 0. ... 0. 0. 0.]]
0
这是一条国内新闻</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">dora</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dora</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
